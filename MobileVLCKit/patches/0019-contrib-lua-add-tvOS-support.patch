From 7e1f73d1c4a5d66d0589c88aed419a38ccb3e205 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Felix=20Paul=20K=C3=BChne?= <fkuehne@videolan.org>
Date: Fri, 20 Nov 2015 13:27:09 +0100
Subject: [PATCH 19/21] contrib/lua: add tvOS support

---
 contrib/src/lua/lua-tvos-support.patch | 26 ++++++++++++++++++++++++++
 contrib/src/lua/rules.mak              |  4 ++++
 2 files changed, 30 insertions(+)
 create mode 100644 contrib/src/lua/lua-tvos-support.patch

diff --git a/contrib/src/lua/lua-tvos-support.patch b/contrib/src/lua/lua-tvos-support.patch
new file mode 100644
index 0000000..c84dc34
--- /dev/null
+++ b/contrib/src/lua/lua-tvos-support.patch
@@ -0,0 +1,26 @@
+diff -ru lua/src/loslib.c lua/src/loslib.c
+--- lua/src/loslib.c	2008-01-18 17:38:18.000000000 +0100
++++ lua-fixed/src/loslib.c	2015-11-20 12:21:35.000000000 +0100
+@@ -4,6 +4,9 @@
+ ** See Copyright Notice in lua.h
+ */
+ 
++#ifdef __APPLE__
++#include <TargetConditionals.h>
++#endif
+ 
+ #include <errno.h>
+ #include <locale.h>
+@@ -36,8 +39,12 @@
+ 
+ 
+ static int os_execute (lua_State *L) {
++#if TARGET_OS_TV
++  return 3;
++#else
+   lua_pushinteger(L, system(luaL_optstring(L, 1, NULL)));
+   return 1;
++#endif
+ }
+ 
+ 
diff --git a/contrib/src/lua/rules.mak b/contrib/src/lua/rules.mak
index 8be4af2..d68e8b6 100644
--- a/contrib/src/lua/rules.mak
+++ b/contrib/src/lua/rules.mak
@@ -45,6 +45,7 @@ lua: lua-$(LUA_VERSION).tar.gz .sum-lua
 	$(APPLY) $(SRC)/lua/luac-32bits.patch
 	$(APPLY) $(SRC)/lua/no-localeconv.patch
 	$(APPLY) $(SRC)/lua/lua-ios-support.patch
+	$(APPLY) $(SRC)/lua/lua-tvos-support.patch
 ifdef HAVE_DARWIN_OS
 	(cd $(UNPACK_DIR) && \
 	sed -e 's%gcc%$(CC)%' \
@@ -81,4 +82,7 @@ ifdef HAVE_CROSS_COMPILE
 	cd $</src && $(MAKE) clean && $(MAKE) liblua.a && ranlib liblua.a && $(MAKE) luac
 	cp $</src/luac $(PREFIX)/bin
 endif
+ifdef HAVE_IOS
+	cd $(PREFIX)/bin && rm lua*
+endif
 	touch $@
-- 
2.6.0

