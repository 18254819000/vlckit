From 8381c283f37b45ee09b08b08456d901b57b5f2bb Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Felix=20Paul=20K=C3=BChne?= <fkuehne@videolan.org>
Date: Wed, 15 Jan 2014 15:13:42 +0100
Subject: [PATCH 21/24] package/ios: update for future architectures

---
 extras/package/ios/build.sh | 16 +++++++++++-----
 1 file changed, 11 insertions(+), 5 deletions(-)

diff --git a/extras/package/ios/build.sh b/extras/package/ios/build.sh
index a51ef1d..487052c 100755
--- a/extras/package/ios/build.sh
+++ b/extras/package/ios/build.sh
@@ -110,9 +110,6 @@ PREFIX="${VLCROOT}/install-ios-${PLATFORM}/${ARCH}"
 
 export PATH="${VLCROOT}/extras/tools/build/bin:${VLCROOT}/contrib/${TARGET}/bin:/usr/bin:/bin:/usr/sbin:/sbin:/usr/local/bin:/usr/X11/bin"
 
-# contains gas-processor.pl
-export PATH=$PATH:${VLCROOT}/extras/package/ios/resources
-
 info "Building tools"
 spushd "${VLCROOT}/extras/tools"
 ./bootstrap
@@ -135,7 +132,10 @@ export PLATFORM=$PLATFORM
 export SDK_VERSION=$SDK_VERSION
 
 if [ "$PLATFORM" = "OS" ]; then
-export CFLAGS="-isysroot ${SDKROOT} -arch ${ARCH} -mcpu=cortex-a8 -miphoneos-version-min=${SDK_MIN} ${OPTIM}"
+export CFLAGS="-isysroot ${SDKROOT} -arch ${ARCH} -miphoneos-version-min=${SDK_MIN} ${OPTIM}"
+if [ "$ARCH" != "arm64" ]; then
+export CFLAGS="${CFLAGS} -mcpu=cortex-a8"
+fi
 else
 export CFLAGS="-isysroot ${SDKROOT} -arch ${ARCH} -miphoneos-version-min=${SDK_MIN} ${OPTIM}"
 fi
@@ -156,7 +156,10 @@ fi
 export LDFLAGS="-L${SDKROOT}/usr/lib -arch ${ARCH} -isysroot ${SDKROOT} -miphoneos-version-min=${SDK_MIN}"
 
 if [ "$PLATFORM" = "OS" ]; then
-    EXTRA_CFLAGS="-arch ${ARCH} -mcpu=cortex-a8"
+    EXTRA_CFLAGS="-arch ${ARCH}"
+if [ "$ARCH" != "arm64" ]; then
+    EXTRA_CFLAGS+=" -mcpu=cortex-a8"
+fi
     EXTRA_LDFLAGS="-arch ${ARCH}"
 else
     EXTRA_CFLAGS="-arch ${ARCH}"
@@ -178,6 +181,9 @@ if [ "$PLATFORM" = "OS" ]; then
       export AS="gas-preprocessor.pl ${CC}"
       export ASCPP="gas-preprocessor.pl ${CC}"
       export CCAS="gas-preprocessor.pl ${CC}"
+if [ "$ARCH" = "arm64" ]; then
+    export GASPP_FIX_XCODE5=1
+fi
 else
   export AS="xcrun as"
   export ASCPP="xcrun as"
-- 
1.8.3.4 (Apple Git-47)

